import React from 'react';
import { VulnerabilityType } from '#types';
import { Municipality } from '#store/atom/page/types';

import ListView from '#rscv/List/ListView';
import Button from '#rsca/Button';
import Modal from '#rscv/Modal';
import ModalHeader from '#rscv/Modal/Header';
import ModalBody from '#rscv/Modal/Body';

import SummaryItem from './SummaryItem';
import styles from './styles.scss';

interface SummaryData extends VulnerabilityType {
    value: number;
}
interface Props {
    data: SummaryData[];
    municipalities: Municipality[];
    closeModal: boolean;
}

interface State {
}

const keySelector = (d: SummaryData) => d.id;
const municipalityKeySelector = (d: Municipality) => d.id;

const MunicipalityRenderer = (municipality: Municipality) => (
    <div className={styles.title}>
        {municipality.title}
    </div>
);

class Summary extends React.PureComponent<Props, State> {
    private rendererParams = (_: string, data: SummaryData) => {
        const { title, suffix, iconName, value } = data;
        return ({
            className: styles.summaryItem,
            title,
            suffix,
            iconName,
            value,
        });
    }

    private municipalityParams = (_: number, data: Municipality) => data;

    public render() {
        const {
            data,
            municipalities,
            closeModal,
        } = this.props;

        return (
            <Modal className={styles.modal}>
                <ModalHeader
                    title="Summary"
                    rightComponent={(
                        <Button
                            iconName="close"
                            onClick={closeModal}
                            transparent
                        />
                    )}
                />
                <ModalBody>
                    {municipalities.length > 0 && (
                        <div className={styles.item}>
                            <h3 className={styles.header}>
                                Municipalities
                            </h3>
                            <ListView
                                className={styles.municipalities}
                                data={municipalities}
                                renderer={MunicipalityRenderer}
                                rendererParams={this.municipalityParams}
                                keySelector={municipalityKeySelector}
                                emptyComponent={null}
                            />
                        </div>
                    )}
                    <ListView
                        className={styles.summary}
                        data={data}
                        renderer={SummaryItem}
                        rendererParams={this.rendererParams}
                        keySelector={keySelector}
                    />
                </ModalBody>
            </Modal>
        );
    }
}

export default Summary;
